const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Login-CtoVFimy.js","assets/react-3CbgUVXy.js","assets/vendor-FY51MtzY.js","assets/Register-DBuqtuVt.js","assets/Listas-Dz_jkYQ8.js","assets/Proveedores-DjQpkCYG.js","assets/Insumos-BEty1WKD.js","assets/ListasPrecios-Dv65C71y.js"])))=>i.map(i=>d[i]);
import{b as B,r as c,R as e,O as U,N as T,u as j,L as _,B as q,c as z,d as E}from"./react-3CbgUVXy.js";import{a as D,B as P,C as w,N as v,b as V,S as $}from"./vendor-FY51MtzY.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))p(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&p(o)}).observe(document,{childList:!0,subtree:!0});function l(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function p(r){if(r.ep)return;r.ep=!0;const a=l(r);fetch(r.href,a)}})();var R,A=B;R=A.createRoot,A.hydrateRoot;const J="modulepreload",F=function(t){return"/"+t},I={},y=function(n,l,p){let r=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),i=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));r=Promise.allSettled(l.map(m=>{if(m=F(m),m in I)return;I[m]=!0;const g=m.endsWith(".css"),f=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${f}`))return;const s=document.createElement("link");if(s.rel=g?"stylesheet":J,g||(s.as="script"),s.crossOrigin="",s.href=m,i&&s.setAttribute("nonce",i),document.head.appendChild(s),g)return new Promise((u,d)=>{s.addEventListener("load",u),s.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${m}`)))})}))}function a(o){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=o,window.dispatchEvent(i),!i.defaultPrevented)throw o}return r.then(o=>{for(const i of o||[])i.status==="rejected"&&a(i.reason);return n().catch(a)})},N="https://abitare-backend.onrender.com/api";console.log(`API Base URL: ${N}`);const L=D.create({baseURL:N,timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/json"}});L.interceptors.request.use(t=>{const n=localStorage.getItem("token");return n&&(t.headers.Authorization=`Bearer ${n}`),t},t=>Promise.reject(t));L.interceptors.response.use(t=>t,t=>(t.response?t.response.status===401?(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.pathname!=="/login"&&(window.location.href="/login")):t.response.status>=500&&console.error("Error del servidor:",t.response.data):t.request?console.error("No se recibió respuesta del servidor:",t.request):console.error("Error al configurar la solicitud:",t.message),Promise.reject(t)));const O=c.createContext(),G=({children:t})=>{const[n,l]=c.useState(null),[p,r]=c.useState(!0);c.useEffect(()=>{(async()=>{if(!localStorage.getItem("token")){r(!1);return}try{const u=await L.get("/auth/me");l(u.data.data)}catch(u){console.error("Error al cargar el usuario:",u),localStorage.removeItem("token")}finally{r(!1)}})()},[]);const a=async(f,s)=>{var u,d;try{const h=await L.post("/auth/login",{email:f,password:s}),{token:S,user:b}=h.data;return localStorage.setItem("token",S),localStorage.setItem("user",JSON.stringify(b)),l(b),{success:!0}}catch(h){return console.error("Error al iniciar sesión:",h),{success:!1,message:((d=(u=h.response)==null?void 0:u.data)==null?void 0:d.message)||"Error al iniciar sesión"}}},o=async f=>{var s,u;try{const d=await L.post("/auth/register",f),{token:h,user:S}=d.data;return localStorage.setItem("token",h),localStorage.setItem("user",JSON.stringify(S)),l(S),{success:!0}}catch(d){return console.error("Error al registrar:",d),{success:!1,message:((u=(s=d.response)==null?void 0:s.data)==null?void 0:u.message)||"Error al registrar el usuario"}}},i=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),l(null),window.location.href="/login"},m=()=>!!n,g=()=>(n==null?void 0:n.role)==="admin";return e.createElement(O.Provider,{value:{user:n,loading:p,login:a,register:o,logout:i,isAuthenticated:m,isAdmin:g}},!p&&t)},C=()=>{const t=c.useContext(O);if(!t)throw new Error("useAuth debe usarse dentro de un AuthProvider");return t},H=()=>{const{isAuthenticated:t,loading:n}=C();return n?e.createElement("div",null,"Cargando..."):t()?e.createElement(U,null):e.createElement(T,{to:"/login"})},x=()=>{const{user:t,logout:n,isAuthenticated:l}=C(),p=j(),r=()=>{n(),p("/login")};return l()?e.createElement(P,{bg:"dark",variant:"dark",expand:"lg",className:"mb-4"},e.createElement(w,null,e.createElement(P.Brand,{as:_,to:"/"},"Gestión de Insumos"),e.createElement(P.Toggle,{"aria-controls":"basic-navbar-nav"}),e.createElement(P.Collapse,{id:"basic-navbar-nav"},e.createElement(v,{className:"me-auto"},e.createElement(v.Link,{as:_,to:"/listas"},"Listas"),e.createElement(v.Link,{as:_,to:"/proveedores"},"Proveedores"),e.createElement(v.Link,{as:_,to:"/insumos"},"Insumos"),(t==null?void 0:t.role)==="admin"&&e.createElement(v.Link,{as:_,to:"/admin"},"Administración")),e.createElement(v,null,e.createElement(x.Text,{className:"me-3"},"Hola, ",(t==null?void 0:t.username)||"Usuario"),e.createElement(V,{variant:"outline-light",onClick:r},"Cerrar Sesión"))))):null},K=c.lazy(()=>y(()=>import("./Login-CtoVFimy.js"),__vite__mapDeps([0,1,2]))),W=c.lazy(()=>y(()=>import("./Register-DBuqtuVt.js"),__vite__mapDeps([3,1,2]))),k=c.lazy(()=>y(()=>import("./Listas-Dz_jkYQ8.js"),__vite__mapDeps([4,1,2]))),Q=c.lazy(()=>y(()=>import("./Proveedores-DjQpkCYG.js"),__vite__mapDeps([5,1,2]))),X=c.lazy(()=>y(()=>import("./Insumos-BEty1WKD.js"),__vite__mapDeps([6,1,2]))),Y=c.lazy(()=>y(()=>import("./ListasPrecios-Dv65C71y.js"),__vite__mapDeps([7,1,2]))),Z=()=>e.createElement("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh"}},e.createElement($,{animation:"border",role:"status"},e.createElement("span",{className:"visually-hidden"},"Cargando aplicación...")));window.addEventListener("unhandledrejection",t=>{console.error("Error no manejado:",t.reason)});function M(){return e.createElement(q,{basename:"/"},e.createElement(G,null,e.createElement("div",{className:"App"},e.createElement(x,null),e.createElement(w,{className:"mt-4"},e.createElement(c.Suspense,{fallback:e.createElement(Z,null)},e.createElement(z,null,e.createElement(E,{path:"/login",element:e.createElement(K,null)}),e.createElement(E,{path:"/register",element:e.createElement(W,null)}),e.createElement(E,{element:e.createElement(H,null)},e.createElement(E,{path:"/",element:e.createElement(k,null)}),e.createElement(E,{path:"/listas",element:e.createElement(k,null)}),e.createElement(E,{path:"/proveedores",element:e.createElement(Q,null)}),e.createElement(E,{path:"/insumos",element:e.createElement(X,null)}),e.createElement(E,{path:"/listas-precios",element:e.createElement(Y,null)})),e.createElement(E,{path:"*",element:e.createElement("main",{className:"text-center py-5"},e.createElement("h2",null,"¡Ups! Página no encontrada"),e.createElement("p",null,"La página que estás buscando no existe o ha sido movida."))})))))))}const ee=document.getElementById("root"),te=R(ee);te.render(e.createElement(e.StrictMode,null,e.createElement(M,null)));export{L as a,C as u};
//# sourceMappingURL=index-BEBrXeq0.js.map
